<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactoryOrder Nigeria</title>
    <style>
        :root { --primary: #1a2a3a; --accent: #27ae60; --gray: #f4f7f6; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--gray); margin: 0; padding: 10px; padding-bottom: 220px; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; border-radius: 8px; margin-bottom: 15px; }
        .cust-section { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .cust-section label { display: block; font-size: 0.75rem; font-weight: bold; color: var(--primary); margin-bottom: 5px; text-transform: uppercase; }
        .cust-input { width: 100%; padding: 12px; border: 2px solid #cbd5e0; border-radius: 6px; box-sizing: border-box; font-size: 1rem; font-weight: 500; }
        .cat-title { background: #cbd5e0; padding: 10px 12px; font-weight: 800; color: #1a2a3a; border-radius: 4px; margin: 20px 0 10px 0; font-size: 0.85rem; text-transform: uppercase; }
        .item-card { background: white; padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .item-info { flex: 1; }
        .item-info b { display: block; font-size: 0.95rem; text-transform: lowercase; color: #2d3748; }
        .item-info span { font-size: 0.75rem; color: #718096; }
        input[type="number"] { width: 75px; padding: 10px; border: 2px solid #cbd5e0; border-radius: 6px; text-align: center; font-size: 1rem; font-weight: bold; }
        
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: var(--primary); color: white; padding: 15px; z-index: 1000; }
        .stats { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 1.1rem; font-weight: bold; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; }
        .btn-wa { background: var(--accent); grid-column: span 2; font-size: 1rem; }
        .btn-view { background: #3498db; }
        .btn-log { background: #9b59b6; }
        .btn-reset { background: #e74c3c; grid-column: span 2; margin-top: 5px; font-size: 0.7rem; padding: 5px; }

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; padding: 15px; box-sizing: border-box; color: white; overflow-y: auto; }
        .modal-body { background: white; color: #333; padding: 15px; border-radius: 8px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; }
        th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
        .dl-btn { background: #2c3e50; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0">Factoryorder</h2>
    <div style="font-size: 0.75rem; opacity: 0.8;">Skretting & Hendrix Records</div>
</header>

<div class="cust-section">
    <label>Customer Name</label>
    <input type="text" id="customerName" class="cust-input" placeholder="Enter name...">
</div>

<div id="content">
    <div class="cat-title">SKRETTING CRUMBLES</div>
    <div class="item-card"><div class="item-info"><b>perla larva</b><span>₦14,000 | 1kg</span></div><input type="number" class="qty" data-n="perla larva" data-p="14000" data-w="1"></div>
    <div class="item-card"><div class="item-info"><b>0.5mm</b><span>₦56,000 | 5kg</span></div><input type="number" class="qty" data-n="0.5mm" data-p="56000" data-w="5"></div>
    <div class="item-card"><div class="item-info"><b>1.0mm</b><span>₦37,500 | 5kg</span></div><input type="number" class="qty" data-n="1.0mm" data-p="37500" data-w="5"></div>
    <div class="item-card"><div class="item-info"><b>1.8mm</b><span>₦22,250 | 5kg</span></div><input type="number" class="qty" data-n="1.8mm" data-p="22250" data-w="5"></div>
    <div class="item-card"><div class="item-info"><b>2.0mm</b><span>₦30,150 | 15kg</span></div><input type="number" class="qty" data-n="2.0mm" data-p="30150" data-w="15"></div>

    <div class="cat-title">SKRETTING SUPERIOR</div>
    <div class="item-card"><div class="item-info"><b>3.0mm</b><span>₦25,800 | 15kg</span></div><input type="number" class="qty" data-n="sup 3.0mm" data-p="25800" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>4.5mm</b><span>₦24,300 | 15kg</span></div><input type="number" class="qty" data-n="sup 4.5mm" data-p="24300" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>6.0mm</b><span>₦24,300 | 15kg</span></div><input type="number" class="qty" data-n="sup 6.0mm" data-p="24300" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>8.0mm</b><span>₦24,300 | 15kg</span></div><input type="number" class="qty" data-n="sup 8.0mm" data-p="24300" data-w="15"></div>

    <div class="cat-title">SKRETTING ESSENTIAL</div>
    <div class="item-card"><div class="item-info"><b>3.0mm</b><span>₦24,450 | 15kg</span></div><input type="number" class="qty" data-n="ess 3.0mm" data-p="24450" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>4.5mm</b><span>₦22,650 | 15kg</span></div><input type="number" class="qty" data-n="ess 4.5mm" data-p="22650" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>6.0mm</b><span>₦21,150 | 15kg</span></div><input type="number" class="qty" data-n="ess 6.0mm" data-p="21150" data-w="15"></div>
    <div class="item-card"><div class="item-info"><b>8.0mm</b><span>₦19,650 | 15kg</span></div><input type="number" class="qty" data-n="ess 8.0mm" data-p="19650" data-w="15"></div>

    <div class="cat-title">HENDRIX PRO PELLETS</div>
    <div class="item-card"><div class="item-info"><b>b.prestarter</b><span>₦21,500 | 25kg</span></div><input type="number" class="qty" data-n="b.prestarter" data-p="21500" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>b.starter</b><span>₦20,000 | 25kg</span></div><input type="number" class="qty" data-n="b.pro starter" data-p="20000" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>b.grower</b><span>₦19,750 | 25kg</span></div><input type="number" class="qty" data-n="b.grower" data-p="19750" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>b.finisher</b><span>₦19,250 | 25kg</span></div><input type="number" class="qty" data-n="b.finisher" data-p="19250" data-w="25"></div>

    <div class="cat-title">HENDRIX ESSENTIAL PELLETS</div>
    <div class="item-card"><div class="item-info"><b>b.starter</b><span>₦17,000 | 25kg</span></div><input type="number" class="qty" data-n="b.ess starter" data-p="17000" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>b.finisher</b><span>₦16,500 | 25kg</span></div><input type="number" class="qty" data-n="b.ess finisher" data-p="16500" data-w="25"></div>

    <div class="cat-title">HENDRIX CONCENTRATE</div>
    <div class="item-card"><div class="item-info"><b>lay.production</b><span>₦85,250 | 50kg</span></div><input type="number" class="qty" data-n="lay.production" data-p="85250" data-w="50"></div>
    <div class="item-card"><div class="item-info"><b>lay.rearer</b><span>₦85,250 | 50kg</span></div><input type="number" class="qty" data-n="lay.rearer" data-p="85250" data-w="50"></div>
    <div class="item-card"><div class="item-info"><b>b.starter</b><span>₦100,250 | 50kg</span></div><input type="number" class="qty" data-n="conc b.starter" data-p="100250" data-w="50"></div>
    <div class="item-card"><div class="item-info"><b>b.finisher</b><span>₦95,250 | 50kg</span></div><input type="number" class="qty" data-n="conc b.finisher" data-p="95250" data-w="50"></div>
    <div class="item-card"><div class="item-info"><b>breeder</b><span>₦90,000 | 50kg</span></div><input type="number" class="qty" data-n="breeder" data-p="90000" data-w="50"></div>

    <div class="cat-title">HENDRIX4U MASH</div>
    <div class="item-card"><div class="item-info"><b>chick</b><span>₦19,000 | 25kg</span></div><input type="number" class="qty" data-n="chick mash" data-p="19000" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>grower</b><span>₦17,200 | 25kg</span></div><input type="number" class="qty" data-n="grower mash" data-p="17200" data-w="25"></div>
    <div class="item-card"><div class="item-info"><b>layer</b><span>₦17,100 | 25kg</span></div><input type="number" class="qty" data-n="layer mash" data-p="17100" data-w="25"></div>
</div>

<div class="footer">
    <div class="stats">
        <span><span id="wt">0</span> kg</span>
        <span>₦<span id="val">0</span></span>
    </div>
    <div class="btn-grid">
        <button class="btn-wa" onclick="sendWA()">SEND WHATSAPP</button>
        <button class="btn-view" onclick="showSummary()">VIEW ORDER</button>
        <button class="btn-log" onclick="showMonthlyLog()">MONTHLY LOG</button>
        <button class="btn-reset" onclick="clearData()">RESET ORDER</button>
    </div>
</div>

<div id="modal">
    <button onclick="closeModal()" style="background:#e74c3c; float:right; border-radius:5px; padding:8px 15px;">CLOSE</button>
    <div class="modal-body" id="modal-content"></div>
</div>

<script>
    const inputs = document.querySelectorAll('.qty');
    const wtDisp = document.getElementById('wt');
    const valDisp = document.getElementById('val');
    const custInput = document.getElementById('customerName');

    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('fo_current_v9') || '{}');
        const savedName = localStorage.getItem('fo_cust_name') || '';
        custInput.value = savedName;
        inputs.forEach(i => { if(saved[i.dataset.n]) i.value = saved[i.dataset.n]; });
        calc();
    };

    function calc() {
        let tW = 0, tV = 0;
        const toSave = {};
        inputs.forEach(i => {
            const q = parseFloat(i.value) || 0;
            tW += (q * parseFloat(i.dataset.w));
            tV += (q * parseFloat(i.dataset.p));
            if(q > 0) toSave[i.dataset.n] = q;
        });
        wtDisp.innerText = tW.toLocaleString();
        valDisp.innerText = tV.toLocaleString();
        localStorage.setItem('fo_current_v9', JSON.stringify(toSave));
        localStorage.setItem('fo_cust_name', custInput.value);
    }

    inputs.forEach(i => i.addEventListener('input', calc));
    custInput.addEventListener('input', calc);

    function showSummary() {
        let name = custInput.value.trim() || "N/A";
        let html = `<h3>Order Summary</h3><p><b>Customer:</b> ${name}</p><table><tr><th>Product</th><th>Qty</th><th>Wt</th><th>Amt</th></tr>`;
        let has = false;
        inputs.forEach(i => {
            const q = parseFloat(i.value) || 0;
            if(q > 0) {
                has = true;
                const amt = q * parseFloat(i.dataset.p);
                const weight = q * parseFloat(i.dataset.w);
                html += `<tr><td>${i.dataset.n}</td><td>${q}</td><td>${weight}kg</td><td>₦${amt.toLocaleString()}</td></tr>`;
            }
        });
        if(!has) return alert("Empty order!");
        html += `</table><p><b>Total Weight:</b> ${wtDisp.innerText}kg<br><b>Grand Total:</b> ₦${valDisp.innerText}</p>`;
        document.getElementById('modal-content').innerHTML = html;
        document.getElementById('modal').style.display = 'block';
    }

    function sendWA() {
        const log = JSON.parse(localStorage.getItem('fo_monthly_v9') || '[]');
        const items = [];
        const customer = custInput.value.trim() || "Valued Customer";
        
        inputs.forEach(i => {
            const q = parseFloat(i.value) || 0;
            if(q > 0) items.push({ n: i.dataset.n, q: q, p: i.dataset.p, w: i.dataset.w });
        });
        if(items.length === 0) return alert("No items!");

        log.push({ date: new Date().toLocaleString(), customer: customer, items: items });
        localStorage.setItem('fo_monthly_v9', JSON.stringify(log));

        let m = `*NEW FACTORY ORDER*\n------------------\n*Customer:* ${customer}\n------------------\n`;
        items.forEach(i => { 
            const unitPrice = parseFloat(i.p).toLocaleString();
            const lineTotal = (i.q * i.p).toLocaleString();
            m += `• ${i.n.toUpperCase()}\n  ₦${unitPrice} x ${i.q} = ₦${lineTotal}\n\n`; 
        });
        m += `------------------\n*TOTAL:* ₦${valDisp.innerText}\n*WEIGHT:* ${wtDisp.innerText}kg`;
        window.open(`https://wa.me/?text=${encodeURIComponent(m)}`, '_blank');
    }

    function showMonthlyLog() {
        const log = JSON.parse(localStorage.getItem('fo_monthly_v9') || '[]');
        if(log.length === 0) return alert("No history!");
        
        let html = "<h3>Monthly History</h3>";
        let tw = 0, tv = 0;
        log.forEach((e, idx) => {
            html += `<div style="background:#f0f0f0; padding:10px; margin-top:15px; border-radius:5px;">
                        <b>Order #${idx+1} - ${e.date}</b><br>
                        <b>Cust:</b> ${e.customer}
                    </div><table>`;
            e.items.forEach(i => {
                const total = i.q * i.p; const weight = i.q * i.w;
                tw += weight; tv += total;
                html += `<tr><td>${i.n}</td><td>${i.q}</td><td>${weight}kg</td><td>₦${total.toLocaleString()}</td></tr>`;
            });
            html += "</table>";
        });
        html += `<div style="border-top:2px solid #333; margin-top:20px;">
            <p><b>Monthly Weight:</b> ${tw.toLocaleString()}kg<br><b>Monthly Sales:</b> ₦${tv.toLocaleString()}</p>
            <button onclick="downloadLog()" class="dl-btn">DOWNLOAD LOG (.TXT)</button>
            <button onclick="clearMonthly()" style="background:#e74c3c; color:white; border:none; padding:10px; border-radius:5px; width:100%; margin-top:10px;">Clear History</button>
        </div>`;
        document.getElementById('modal-content').innerHTML = html;
        document.getElementById('modal').style.display = 'block';
    }

    function downloadLog() {
        const log = JSON.parse(localStorage.getItem('fo_monthly_v9') || '[]');
        let text = "FACTORY ORDER LOG\n==========================\n\n";
        let tw = 0, tv = 0;
        log.forEach((e, idx) => {
            text += `Order #${idx+1} - ${e.date}\nCustomer: ${e.customer}\n`;
            e.items.forEach(i => {
                const total = i.q * i.p; const weight = i.q * i.w;
                tw += weight; tv += total;
                text += `  - ${i.n}: ${i.q} bags @ ₦${parseFloat(i.p).toLocaleString()} = ₦${total.toLocaleString()}\n`;
            });
            text += `--------------------------\n`;
        });
        text += `\nGRAND TOTALS:\nTotal Weight: ${tw.toLocaleString()}kg\nTotal Value: ₦${tv.toLocaleString()}`;
        
        const blob = new Blob([text], { type: 'text/plain' });
        const anchor = document.createElement('a');
        anchor.download = `FactoryLog_${new Date().toISOString().split('T')[0]}.txt`;
        anchor.href = (window.webkitURL || window.URL).createObjectURL(blob);
        anchor.click();
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function clearData() { if(confirm("Clear order?")) { inputs.forEach(i => i.value = ""); custInput.value = ""; calc(); } }
    function clearMonthly() { if(confirm("Delete history?")) { localStorage.removeItem('fo_monthly_v9'); closeModal(); } }
</script>
</body>
</html>
